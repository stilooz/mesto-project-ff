(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function e(){var t=document.querySelector(".popup_is-opened");t&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o))}function o(t){"Escape"===t.key&&e()}function n(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function r(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}var c,u=function(t,o,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);t.owner&&t.owner._id===c?(u.querySelector(".card__delete-button").style.display="block",function(t,o){t.querySelector(".card__delete-button").addEventListener("click",(function(){var n=document.querySelector(".popup_type_confirm"),r=n.querySelector("form"),c=function(n){n.preventDefault(),function(t){return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/cards/".concat(t),{method:"DELETE",headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o).then((function(){t.remove(),e()})).catch((function(t){console.error("Ошибка при удалении карточки:",t)}))};r.removeEventListener("submit",c),r.addEventListener("submit",c),n.classList.add("popup_is-opened")}))}(u,t._id)):u.querySelector(".card__delete-button").remove();var a=u.querySelector(".card__image");u.querySelector(".card__title").textContent=t.name;var i=u.querySelector(".card__like-count");i.textContent=t.likes.length,a.setAttribute("src",t.link),a.setAttribute("alt","фотография ".concat(t.name)),a.addEventListener("click",(function(){o(t.name,t.link)}));var s=u.querySelector(".card__like-button");return t.likes.some((function(t){return t._id===c}))&&s.classList.add("card__like-button_is-active"),function(t,e,o){t.addEventListener("click",(function(){(t.classList.contains("card__like-button_is-active")?r:n)(e).then((function(e){t.classList.toggle("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(t){console.error("Ошибка при изменении лайка:",t)}))}))}(s,t._id,i),u};function a(t,e,o){var n=t.querySelector("#".concat(e.id,"-error"));n&&(e.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass))}function i(t,e,o){t.some((function(t){return!t.validity.valid}))?(e.classList.add(o.inactiveButtonClass),e.disabled=!0):(e.classList.remove(o.inactiveButtonClass),e.disabled=!1)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}var l,p=document.querySelector(".places__list"),d=document.forms["new-place"],f=document.querySelector(".popup__input_type_card-name"),_=document.querySelector(".popup__input_type_url"),m=document.querySelector(".profile__add-button"),y=document.querySelector(".popup_type_new-card"),v=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),h=document.querySelector(".popup__caption"),S=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),q=document.querySelector(".popup__input_type_name"),E=document.querySelector(".popup__input_type_description"),k=document.forms["edit-profile"],L=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_edit"),j=document.querySelectorAll(".popup__close"),A=document.querySelectorAll(".popup"),x=document.forms["update-avatar"],w=x.elements.avatar,P=document.querySelector(".profile__image"),T=document.querySelector(".popup_type_avatar"),z=document.querySelector(".popup_type_confirm");function B(e,o){b.src=o,b.alt="Фотография ".concat(e),h.textContent=e,t(v)}z.querySelector(".popup__close").addEventListener("click",(function(){return e()})),z.addEventListener("click",(function(t){t.target===z&&e()})),L.addEventListener("click",(function(){q.value=S.textContent,E.value=C.textContent;var e=Array.from(k.querySelectorAll(".popup__input")),o=k.querySelector(".popup__button");e.forEach((function(t){t.setCustomValidity(""),a(k,t,{inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),i(e,o,{inactiveButtonClass:"popup__button_disabled"}),t(g)})),document.querySelector(".profile__image").addEventListener("click",(function(){var e=Array.from(x.querySelectorAll(".popup__input")),o=x.querySelector(".popup__button");e.forEach((function(t){a(x,t,{inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),i(e,o,{inactiveButtonClass:"popup__button_disabled"}),x.reset(),t(T)})),x.addEventListener("submit",(function(t){t.preventDefault();var o,n,r=x.querySelector(".popup__button"),c=r.textContent;r.textContent="Сохранение...",(o={avatar:w.value},n=o.avatar,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/users/me/avatar",{method:"PATCH",headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903","Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){P.style.backgroundImage="url(".concat(t.avatar,")"),e()})).catch((function(t){console.error("Ошибка при обновлении аватара:",t)})).finally((function(){r.textContent=c}))})),d.addEventListener("submit",(function(t){t.preventDefault();var o=f.value,n=_.value,r=d.querySelector(".popup__button"),a=r.textContent;r.textContent="Сохранение...",function(t){var e=t.name,o=t.link;return fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/cards",{method:"POST",headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903","Content-Type":"application/json"},body:JSON.stringify({name:e,link:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}({name:o,link:n}).then((function(t){var o=u(t,B,c);p.prepend(o),e(),d.reset()})).catch((function(t){console.error("Ошибка при добавлении карточки:",t)})).finally((function(){r.textContent=a}))})),m.addEventListener("click",(function(){var e=Array.from(d.querySelectorAll(".popup__input")),o=d.querySelector(".popup__button");e.forEach((function(t){a(d,t,{inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),i(e,o,{inactiveButtonClass:"popup__button_disabled"}),t(y)})),j.forEach((function(t){t.addEventListener("click",e)})),A.forEach((function(t){t.addEventListener("click",(function(o){o.target===t&&e()}))})),k.addEventListener("submit",(function(t){t.preventDefault();var o,n,r,c=k.querySelector(".popup__button"),u=c.textContent;c.textContent="Сохранение...",(o={name:q.value,about:E.value},n=o.name,r=o.about,fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/users/me",{method:"PATCH",headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903","Content-Type":"application/json"},body:JSON.stringify({name:n,about:r})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){S.textContent=t.name,C.textContent=t.about,e()})).catch((function(t){console.error("Ошибка при обновлении профиля:",t)})).finally((function(){c.textContent=u}))})),l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(l.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);i(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){var n=e.dataset.errorMessage,r=e.name;e.setCustomValidity(""),e.validity.valueMissing?e.setCustomValidity(n):"name"!==r&&"description"!==r&&"place-name"!==r||/^[А-ЯA-ZЁёа-яa-z\s-]+$/i.test(e.value)||e.setCustomValidity(n),e.validity.valid?a(t,e,o):function(t,e,o,n){var r=t.querySelector("#".concat(e.id,"-error"));r&&(e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass))}(t,e,e.validationMessage,o)}(t,r,e),i(o,n,e)}))}))}(t,l)})),Promise.all([fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/users/me",{headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-36/cards",{headers:{authorization:"1b90838c-6394-4588-b4b1-865db972e903"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))]).then((function(t){var e,o,n=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,c,u,a=[],i=!0,s=!1;try{if(c=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;i=!1}else for(;!(i=(n=c.call(o)).done)&&(a.push(n.value),a.length!==e);i=!0);}catch(t){s=!0,r=t}finally{try{if(!i&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(s)throw r}}return a}}(e,o)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?s(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],a=n[1];S.textContent=r.name,C.textContent=r.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(r.avatar,")"),c=r._id,a.forEach((function(t){var e=u(t,B,c);p.append(e)}))})).catch((function(t){console.error("Ошибка при загрузке данных:",t)}))})();